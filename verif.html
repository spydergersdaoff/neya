<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Neya ‚Äî V√©rification</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0e1a;
    --cyan: #00d4ff;
    --pink: #ff006e;
    --green: #00ff88;
    --muted: #7986cb;
    --border: #1e2a4a;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    background: var(--bg);
    font-family: 'Rajdhani', sans-serif;
    color: #e8eaf6;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  /* Grille de fond */
  .bg-grid {
    position: fixed; inset: 0; pointer-events: none;
    background-image:
      linear-gradient(rgba(0,212,255,0.04) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,212,255,0.04) 1px, transparent 1px);
    background-size: 60px 60px;
  }
  .bg-glow {
    position: fixed; top: -100px; left: 50%; transform: translateX(-50%);
    width: 600px; height: 400px; pointer-events: none;
    background: radial-gradient(ellipse, rgba(0,212,255,0.1) 0%, transparent 70%);
  }

  .card {
    position: relative;
    background: linear-gradient(135deg, rgba(20,26,46,0.98), rgba(15,21,37,0.99));
    border: 1px solid rgba(0,212,255,0.2);
    border-radius: 24px;
    padding: 3rem 2.5rem;
    max-width: 440px;
    width: 100%;
    text-align: center;
    box-shadow: 0 0 80px rgba(0,212,255,0.08), 0 30px 80px rgba(0,0,0,0.6);
    animation: cardIn 0.5s cubic-bezier(0.34,1.56,0.64,1) both;
  }
  @keyframes cardIn {
    from { opacity:0; transform: translateY(24px) scale(0.97); }
    to   { opacity:1; transform: translateY(0) scale(1); }
  }

  .logo-wrap {
    display: flex; align-items: center; justify-content: center;
    gap: 0.6rem; margin-bottom: 2rem;
  }
  .logo-img {
    width: 44px; height: 44px; border-radius: 50%; object-fit: cover;
    border: 2px solid rgba(0,212,255,0.4);
    box-shadow: 0 0 16px rgba(0,212,255,0.25);
  }
  .logo-text {
    font-family: 'Bebas Neue', cursive; font-size: 2.2rem; letter-spacing: 3px;
    background: linear-gradient(135deg, var(--cyan), var(--pink));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  }

  /* Ic√¥ne centrale anim√©e */
  .status-icon {
    width: 80px; height: 80px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    margin: 0 auto 1.5rem;
    font-size: 2rem;
    position: relative;
  }
  .status-icon.loading {
    background: rgba(0,212,255,0.08);
    border: 2px solid rgba(0,212,255,0.2);
  }
  .status-icon.loading::after {
    content: '';
    position: absolute; inset: -4px;
    border-radius: 50%;
    border: 3px solid transparent;
    border-top-color: var(--cyan);
    animation: spin 0.9s linear infinite;
  }
  .status-icon.success {
    background: rgba(0,255,136,0.1);
    border: 2px solid rgba(0,255,136,0.3);
    animation: popIn 0.4s cubic-bezier(0.34,1.56,0.64,1) both;
  }
  .status-icon.error {
    background: rgba(255,0,110,0.1);
    border: 2px solid rgba(255,0,110,0.3);
    animation: popIn 0.4s cubic-bezier(0.34,1.56,0.64,1) both;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  @keyframes popIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }

  .status-title {
    font-family: 'Bebas Neue', cursive;
    font-size: 1.7rem; letter-spacing: 2px;
    margin-bottom: 0.5rem;
  }
  .status-title.cyan { color: var(--cyan); }
  .status-title.green { color: var(--green); }
  .status-title.pink { color: var(--pink); }

  .status-sub {
    color: var(--muted); font-size: 0.9rem; line-height: 1.6;
    margin-bottom: 1.5rem;
  }
  .status-sub strong { color: #e8eaf6; }

  /* Barre de progression */
  .progress-wrap {
    background: rgba(255,255,255,0.05);
    border: 1px solid var(--border);
    border-radius: 50px; height: 8px;
    overflow: hidden; margin-bottom: 1rem;
  }
  .progress-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--cyan), var(--pink));
    border-radius: 50px;
    width: 0%;
    transition: width 0.4s ease;
  }

  /* √âtapes */
  .steps { display: flex; flex-direction: column; gap: 0.5rem; margin-bottom: 1.5rem; text-align: left; }
  .step {
    display: flex; align-items: center; gap: 0.75rem;
    padding: 0.55rem 0.85rem;
    border-radius: 8px; border: 1px solid transparent;
    font-size: 0.88rem; font-weight: 500;
    transition: all 0.3s;
    opacity: 0.4;
  }
  .step.active { border-color: rgba(0,212,255,0.2); background: rgba(0,212,255,0.06); opacity: 1; color: var(--cyan); }
  .step.done   { border-color: rgba(0,255,136,0.2); background: rgba(0,255,136,0.05); opacity: 1; color: var(--green); }
  .step-dot {
    width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0;
    background: currentColor;
  }
  .step.active .step-dot { animation: pulse 1s ease-in-out infinite; }
  @keyframes pulse { 0%,100% { opacity:1; transform:scale(1); } 50% { opacity:0.4; transform:scale(0.7); } }

  .btn-retry {
    display: inline-flex; align-items: center; gap: 0.5rem;
    background: var(--pink); color: white;
    font-family: 'Rajdhani', sans-serif; font-weight: 700;
    font-size: 0.9rem; letter-spacing: 1px; text-transform: uppercase;
    padding: 0.7rem 1.5rem; border-radius: 10px; border: none;
    cursor: pointer; transition: all 0.2s; text-decoration: none;
  }
  .btn-retry:hover { opacity: 0.85; transform: translateY(-1px); }

  .redirect-info {
    margin-top: 1rem; font-size: 0.78rem; color: var(--muted);
  }
  .redirect-count { color: var(--cyan); font-weight: 700; }

  /* Particules flottantes */
  .particles { position: fixed; inset: 0; pointer-events: none; }
  .particle {
    position: absolute; border-radius: 50%; opacity: 0.12;
    animation: floatUp linear infinite;
  }
  @keyframes floatUp {
    0%   { transform: translateY(100vh) scale(0); opacity: 0; }
    10%  { opacity: 0.12; }
    90%  { opacity: 0.12; }
    100% { transform: translateY(-10vh) scale(1.5); opacity: 0; }
  }
</style>
</head>
<body>

<div class="bg-grid"></div>
<div class="bg-glow"></div>
<div class="particles" id="particles"></div>

<div class="card">
  <div class="logo-wrap">
    <img src="https://media.discordapp.net/attachments/1457377190110040309/1466842441264140431/LuaGen.webp?ex=6997437a&is=6995f1fa&hm=b679a2f2b0cad748f0ba661e99f56ee7095a356cfcbf86886a702902fd869cc4&=&format=webp"
         alt="Neya" class="logo-img">
    <span class="logo-text">NEYA</span>
  </div>

  <!-- Ic√¥ne de statut -->
  <div class="status-icon loading" id="statusIcon">üîó</div>

  <!-- Titre -->
  <div class="status-title cyan" id="statusTitle">V√©rification en cours...</div>
  <div class="status-sub" id="statusSub">
    Nous v√©rifions votre autorisation Discord.<br>
    <strong>Ne fermez pas cette page.</strong>
  </div>

  <!-- Barre de progression -->
  <div class="progress-wrap" id="progressWrap">
    <div class="progress-bar" id="progressBar"></div>
  </div>

  <!-- √âtapes -->
  <div class="steps" id="steps">
    <div class="step active" id="step1"><div class="step-dot"></div> R√©ception du code Discord</div>
    <div class="step" id="step2"><div class="step-dot"></div> G√©n√©ration du token d'acc√®s</div>
    <div class="step" id="step3"><div class="step-dot"></div> Enregistrement de la session</div>
    <div class="step" id="step4"><div class="step-dot"></div> Redirection vers Neya</div>
  </div>

  <!-- Message d'erreur (cach√© par d√©faut) -->
  <div id="errorBlock" style="display:none;">
    <a href="https://discord.com/oauth2/authorize?client_id=1474838522002145473&redirect_uri=https://restorecord.com/api/callback&response_type=code&scope=identify+guilds.join&state=1472474317194268862&prompt=none"
       class="btn-retry" target="_self">üîÑ R√©essayer l'autorisation</a>
  </div>

  <!-- Info redirection -->
  <div class="redirect-info" id="redirectInfo" style="display:none;">
    Redirection automatique dans <span class="redirect-count" id="countdown">3</span>s...
  </div>
</div>

<script>
  // ============================================================
  // PARTICULES
  // ============================================================
  (function() {
    const c = document.getElementById('particles');
    for (let i = 0; i < 12; i++) {
      const p = document.createElement('div');
      p.className = 'particle';
      const s = Math.random() * 4 + 2;
      p.style.cssText = `width:${s}px;height:${s}px;left:${Math.random()*100}%;bottom:-20px;background:${Math.random()>.5?'#00d4ff':'#ff006e'};animation-duration:${Math.random()*10+8}s;animation-delay:${Math.random()*8}s;`;
      c.appendChild(p);
    }
  })();

  // ============================================================
  // LOGIQUE DE V√âRIFICATION
  // ============================================================
  const SITE_URL   = 'index.html';   // ‚Üê URL de ton site principal
  const TOKEN_KEY  = 'neya_verified_token';
  const TOKEN_DURATION_DAYS = 30;

  function setStep(n) {
    for (let i = 1; i <= 4; i++) {
      const el = document.getElementById('step' + i);
      if (i < n)       { el.className = 'step done'; }
      else if (i === n) { el.className = 'step active'; }
      else              { el.className = 'step'; }
    }
    document.getElementById('progressBar').style.width = ((n - 1) / 4 * 100) + '%';
  }

  function generateToken() {
    const arr = new Uint8Array(32);
    crypto.getRandomValues(arr);
    return Array.from(arr).map(b => b.toString(16).padStart(2,'0')).join('');
  }

  function storeToken(token) {
    // localStorage
    const data = { token, ts: Date.now(), expires: Date.now() + TOKEN_DURATION_DAYS * 86400000 };
    localStorage.setItem(TOKEN_KEY, JSON.stringify(data));

    // Cookie (backup)
    const expires = new Date(Date.now() + TOKEN_DURATION_DAYS * 86400000).toUTCString();
    document.cookie = `${TOKEN_KEY}=${token};expires=${expires};path=/;SameSite=Lax`;
  }

  function showSuccess() {
    const icon = document.getElementById('statusIcon');
    icon.className = 'status-icon success';
    icon.textContent = '‚úÖ';
    document.getElementById('statusTitle').className = 'status-title green';
    document.getElementById('statusTitle').textContent = 'Acc√®s autoris√© !';
    document.getElementById('statusSub').innerHTML = `Tu es maintenant <strong>enregistr√©</strong> sur Neya.<br>Tu n'auras plus besoin de faire √ßa.`;
    document.getElementById('progressBar').style.width = '100%';
    document.getElementById('redirectInfo').style.display = 'block';

    let count = 3;
    document.getElementById('countdown').textContent = count;
    const timer = setInterval(() => {
      count--;
      document.getElementById('countdown').textContent = count;
      if (count <= 0) {
        clearInterval(timer);
        window.location.href = SITE_URL;
      }
    }, 1000);
  }

  function showError(msg) {
    const icon = document.getElementById('statusIcon');
    icon.className = 'status-icon error';
    icon.textContent = '‚ùå';
    document.getElementById('statusTitle').className = 'status-title pink';
    document.getElementById('statusTitle').textContent = 'Autorisation refus√©e';
    document.getElementById('statusSub').innerHTML = msg || `Tu n'as pas autoris√© l'application Discord.<br>Clique ci-dessous pour r√©essayer.`;
    document.getElementById('progressWrap').style.display = 'none';
    document.getElementById('steps').style.display = 'none';
    document.getElementById('errorBlock').style.display = 'block';
  }

  // ============================================================
  // V√âRIFICATION DU CODE DISCORD DANS L'URL
  // ============================================================
  function run() {
    const params = new URLSearchParams(window.location.search);
    const code  = params.get('code');
    const error = params.get('error');

    // Discord a refus√© l'autorisation
    if (error || params.get('error_description')) {
      setTimeout(() => showError(), 800);
      return;
    }

    // Pas de code ‚Üí l'utilisateur est arriv√© directement sur cette page
    if (!code) {
      // V√©rifier s'il a d√©j√† un token valide
      try {
        const stored = JSON.parse(localStorage.getItem(TOKEN_KEY));
        if (stored && stored.expires > Date.now()) {
          // D√©j√† v√©rifi√© ‚Üí rediriger directement
          window.location.href = SITE_URL;
          return;
        }
      } catch {}
      // Sinon rediriger vers Discord
      showError('Aucun code re√ßu. Lance l\'autorisation Discord pour continuer.');
      return;
    }

    // ‚úÖ On a un code Discord ‚Üí l'utilisateur a bien autoris√©
    // Simuler les √©tapes avec des d√©lais r√©alistes
    setTimeout(() => { setStep(2); }, 600);
    setTimeout(() => {
      setStep(3);
      const token = generateToken();
      storeToken(token);
      // Nettoyer l'URL (enlever le code pour √©viter de le r√©utiliser)
      window.history.replaceState({}, document.title, window.location.pathname);
    }, 1300);
    setTimeout(() => { setStep(4); }, 2000);
    setTimeout(() => { showSuccess(); }, 2600);
  }

  // Lancer apr√®s un court d√©lai (pour voir l'animation)
  setTimeout(run, 400);
</script>
</body>
</html>
