<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Neya</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.5.7/hls.min.js"></script>
<script>
(function(){
  document.addEventListener('keydown', function(e) {
    if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J' || e.key === 'C')) || (e.ctrlKey && e.key === 'U')) {
      e.preventDefault(); e.stopPropagation(); return false;
    }
  }, true);
  document.addEventListener('contextmenu', function(e) { e.preventDefault(); return false; });
  (function devtools(){
    const threshold = 160;
    setInterval(function(){
      const before = new Date();
      debugger;
      const after = new Date();
      if (after - before > threshold) { document.body.innerHTML = ''; location.reload(); }
    }, 1000);
  })();
})();
</script>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Rajdhani:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-primary: #0a0e1a;
    --bg-secondary: #0f1525;
    --bg-card: #141a2e;
    --accent-cyan: #00d4ff;
    --accent-pink: #ff006e;
    --accent-green: #00ff88;
    --accent-yellow: #ffd600;
    --text-primary: #e8eaf6;
    --text-muted: #7986cb;
    --border-color: #1e2a4a;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    background: var(--bg-primary);
    color: var(--text-primary);
    font-family: 'Rajdhani', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }
  ::-webkit-scrollbar { width: 4px; height: 4px; }
  ::-webkit-scrollbar-track { background: var(--bg-primary); }
  ::-webkit-scrollbar-thumb { background: var(--accent-cyan); border-radius: 2px; }

  .navbar {
    position: fixed; top: 0; left: 0; right: 0; z-index: 100;
    background: linear-gradient(180deg, rgba(10,14,26,0.98) 0%, rgba(10,14,26,0.8) 100%);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid rgba(0,212,255,0.1);
    padding: 0 2rem;
    height: 64px;
    display: flex; align-items: center; justify-content: space-between;
  }
  .logo {
    font-family: 'Bebas Neue', cursive;
    font-size: 1.8rem;
    background: linear-gradient(135deg, var(--accent-cyan), var(--accent-pink));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    letter-spacing: 2px;
    cursor: pointer;
  }
  .nav-links { display: flex; gap: 2rem; align-items: center; }
  .nav-link {
    color: var(--text-muted);
    font-size: 0.95rem;
    font-weight: 600;
    letter-spacing: 1px;
    text-transform: uppercase;
    cursor: pointer;
    transition: color 0.2s;
    display: flex; align-items: center; gap: 0.4rem;
  }
  .nav-link:hover, .nav-link.active { color: var(--accent-cyan); }
  .nav-right { display: flex; align-items: center; gap: 1rem; }
  .search-box {
    display: flex; align-items: center;
    background: rgba(255,255,255,0.05);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 0.4rem 0.8rem;
    gap: 0.5rem;
    transition: border-color 0.2s;
  }
  .search-box:focus-within { border-color: var(--accent-cyan); }
  .search-box input {
    background: none; border: none; outline: none;
    color: var(--text-primary); font-family: 'Rajdhani', sans-serif;
    font-size: 0.9rem; width: 180px;
  }
  .search-box input::placeholder { color: var(--text-muted); }

  .hero {
    margin-top: 64px;
    position: relative;
    height: 500px;
    overflow: hidden;
    display: flex; align-items: flex-end;
  }
  .hero-bg {
    position: absolute; inset: 0;
    background: linear-gradient(135deg, #0a0e1a 0%, #0d1b3e 50%, #1a0a2e 100%);
  }
  .hero-grid {
    position: absolute; inset: 0;
    background-image:
      linear-gradient(rgba(0,212,255,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,212,255,0.03) 1px, transparent 1px);
    background-size: 50px 50px;
  }
  .hero-content {
    position: relative; z-index: 2;
    padding: 2rem 3rem;
    width: 100%;
    background: linear-gradient(0deg, var(--bg-primary) 0%, transparent 100%);
  }
  .hero-badge {
    display: inline-flex; align-items: center; gap: 0.4rem;
    background: var(--accent-pink); color: white;
    font-size: 0.7rem; font-weight: 700; letter-spacing: 2px;
    padding: 0.25rem 0.75rem; border-radius: 4px;
    text-transform: uppercase; margin-bottom: 0.75rem;
  }
  .hero-title {
    font-family: 'Bebas Neue', cursive;
    font-size: 3.5rem;
    line-height: 1;
    margin-bottom: 0.5rem;
    text-shadow: 0 0 40px rgba(0,212,255,0.3);
  }
  .hero-meta { color: var(--text-muted); font-size: 0.9rem; margin-bottom: 1rem; }
  .hero-desc { color: var(--text-primary); font-size: 1rem; max-width: 500px; margin-bottom: 1.5rem; opacity: 0.8; }
  .btn-primary {
    display: inline-flex; align-items: center; gap: 0.5rem;
    background: var(--accent-cyan); color: var(--bg-primary);
    font-family: 'Rajdhani', sans-serif; font-weight: 700;
    font-size: 0.95rem; letter-spacing: 1px; text-transform: uppercase;
    padding: 0.75rem 2rem; border-radius: 8px; border: none;
    cursor: pointer; transition: all 0.2s;
  }
  .btn-primary:hover { background: #00b8db; transform: translateY(-1px); box-shadow: 0 8px 25px rgba(0,212,255,0.3); }
  .btn-secondary {
    display: inline-flex; align-items: center; gap: 0.5rem;
    background: rgba(255,255,255,0.1); color: var(--text-primary);
    font-family: 'Rajdhani', sans-serif; font-weight: 700;
    font-size: 0.95rem; letter-spacing: 1px; text-transform: uppercase;
    padding: 0.75rem 2rem; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2);
    cursor: pointer; transition: all 0.2s; margin-left: 1rem;
  }
  .btn-secondary:hover { background: rgba(255,255,255,0.15); }

  .section { padding: 2rem 3rem; }
  .section-header {
    display: flex; align-items: center; gap: 0.75rem;
    margin-bottom: 1.5rem;
  }
  .section-title {
    font-family: 'Bebas Neue', cursive;
    font-size: 1.4rem;
    letter-spacing: 2px;
    color: white;
  }
  .section-icon { font-size: 1.2rem; }

  .cards-row {
    display: flex;
    gap: 1rem;
    overflow-x: auto;
    padding-bottom: 1rem;
    scroll-behavior: smooth;
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  .cards-row::-webkit-scrollbar { display: none; }

  .trending-card {
    position: relative;
    flex: 0 0 160px;
    cursor: pointer;
    transition: transform 0.3s;
  }
  .trending-card:hover { transform: scale(1.05); z-index: 5; }
  .trending-number {
    position: absolute;
    bottom: -10px; left: -15px;
    font-family: 'Bebas Neue', cursive;
    font-size: 5rem;
    line-height: 1;
    color: transparent;
    -webkit-text-stroke: 2px var(--accent-pink);
    z-index: 2;
    pointer-events: none;
  }
  .trending-poster {
    width: 100%; aspect-ratio: 2/3;
    border-radius: 10px;
    object-fit: cover;
    border: 1px solid var(--border-color);
    background: var(--bg-card);
  }
  .trending-poster-placeholder {
    width: 100%; aspect-ratio: 2/3;
    border-radius: 10px;
    background: linear-gradient(135deg, var(--bg-card), #1e2a4a);
    border: 1px solid var(--border-color);
    display: flex; align-items: center; justify-content: center;
    font-size: 2.5rem;
  }
  .trending-info {
    margin-top: 0.75rem;
    padding-left: 0.25rem;
  }
  .trending-title {
    font-size: 0.85rem; font-weight: 600;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  }
  .trending-year { font-size: 0.75rem; color: var(--text-muted); }
  .trending-rating {
    font-size: 0.75rem; color: var(--accent-yellow);
    display: flex; align-items: center; gap: 0.25rem;
  }
  .trending-meta-row {
    display: flex; justify-content: space-between; align-items: center;
    margin-top: 0.25rem;
  }

  /* Badge saison multiple */
  .badge-seasons {
    position: absolute; top: 8px; left: 8px;
    background: rgba(0,212,255,0.85); color: var(--bg-primary);
    font-size: 0.6rem; font-weight: 800; letter-spacing: 1px;
    padding: 2px 6px; border-radius: 4px;
    backdrop-filter: blur(4px);
  }

  .badge-hd {
    position: absolute; top: 8px; right: 8px;
    background: var(--accent-cyan); color: var(--bg-primary);
    font-size: 0.6rem; font-weight: 800; letter-spacing: 1px;
    padding: 2px 6px; border-radius: 4px;
  }
  .badge-fhd {
    position: absolute; top: 8px; right: 8px;
    background: var(--accent-pink); color: white;
    font-size: 0.6rem; font-weight: 800; letter-spacing: 1px;
    padding: 2px 6px; border-radius: 4px;
  }

  .filter-tabs {
    display: flex; gap: 0.5rem;
    padding: 1rem 3rem 0;
  }
  .filter-tab {
    padding: 0.5rem 1.5rem;
    border-radius: 50px;
    font-size: 0.85rem; font-weight: 600; letter-spacing: 1px;
    text-transform: uppercase; cursor: pointer;
    border: 1px solid var(--border-color);
    background: transparent; color: var(--text-muted);
    transition: all 0.2s;
  }
  .filter-tab:hover { border-color: var(--accent-cyan); color: var(--accent-cyan); }
  .filter-tab.active {
    background: var(--accent-cyan); color: var(--bg-primary);
    border-color: var(--accent-cyan);
  }

  .modal-overlay {
    position: fixed; inset: 0; z-index: 200;
    background: rgba(0,0,0,0.85);
    backdrop-filter: blur(8px);
    display: flex; align-items: center; justify-content: center;
    padding: 2rem;
  }
  .modal-overlay.hidden { display: none; }
  .modal {
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 16px;
    max-width: 900px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
  }
  .modal-close {
    position: absolute; top: 1rem; right: 1rem;
    background: rgba(255,255,255,0.1); border: none;
    color: white; width: 36px; height: 36px;
    border-radius: 50%; cursor: pointer; font-size: 1.2rem;
    display: flex; align-items: center; justify-content: center;
    transition: background 0.2s; z-index: 10;
  }
  .modal-close:hover { background: rgba(255,0,110,0.5); }
  .modal-player {
    width: 100%;
    aspect-ratio: 16/9;
    background: black;
    border-radius: 12px 12px 0 0;
    overflow: hidden;
  }
  .modal-player iframe, .modal-player video {
    width: 100%; height: 100%; border: none;
  }
  .modal-body { padding: 1.5rem; }
  .modal-title { font-family: 'Bebas Neue', cursive; font-size: 2rem; margin-bottom: 0.5rem; }
  .modal-desc { color: var(--text-muted); font-size: 0.9rem; line-height: 1.6; }

  /* S√©lecteur de saison */
  .season-selector {
    display: flex; gap: 0.5rem; flex-wrap: wrap;
    margin-bottom: 1rem;
  }
  .season-btn {
    padding: 0.4rem 1rem;
    border-radius: 50px;
    font-size: 0.82rem; font-weight: 700; letter-spacing: 1px;
    text-transform: uppercase; cursor: pointer;
    border: 1px solid var(--border-color);
    background: transparent; color: var(--text-muted);
    font-family: 'Rajdhani', sans-serif;
    transition: all 0.2s;
  }
  .season-btn:hover { border-color: var(--accent-cyan); color: var(--accent-cyan); }
  .season-btn.active {
    background: var(--accent-cyan); color: var(--bg-primary);
    border-color: var(--accent-cyan);
  }

  .admin-overlay {
    position: fixed; inset: 0; z-index: 500;
    background: rgba(0,0,0,0.92);
    backdrop-filter: blur(16px);
    display: flex; align-items: center; justify-content: center;
    padding: 1rem;
  }
  .admin-overlay.hidden { display: none; }
  .admin-panel {
    background: var(--bg-secondary);
    border: 1px solid rgba(0,212,255,0.3);
    border-radius: 20px;
    width: 100%;
    max-width: 800px;
    max-height: 90vh;
    overflow-y: auto;
    padding: 2rem;
    box-shadow: 0 0 80px rgba(0,212,255,0.1);
  }
  .admin-title {
    font-family: 'Bebas Neue', cursive;
    font-size: 2rem; letter-spacing: 3px;
    background: linear-gradient(135deg, var(--accent-cyan), var(--accent-pink));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    margin-bottom: 1.5rem;
  }
  .admin-input {
    width: 100%;
    background: rgba(255,255,255,0.05);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 0.75rem 1rem;
    color: var(--text-primary);
    font-family: 'Rajdhani', sans-serif;
    font-size: 0.95rem;
    outline: none;
    transition: border-color 0.2s;
  }
  .admin-input:focus { border-color: var(--accent-cyan); }
  .admin-select {
    width: 100%;
    background: rgba(255,255,255,0.05);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 0.75rem 1rem;
    color: var(--text-primary);
    font-family: 'Rajdhani', sans-serif;
    font-size: 0.95rem;
    outline: none;
    cursor: pointer;
  }
  .admin-select option { background: var(--bg-secondary); }
  .admin-label {
    display: block; font-size: 0.8rem; font-weight: 700;
    letter-spacing: 1px; text-transform: uppercase;
    color: var(--text-muted); margin-bottom: 0.4rem;
  }
  .admin-btn {
    padding: 0.75rem 1.5rem;
    border-radius: 8px; border: none; cursor: pointer;
    font-family: 'Rajdhani', sans-serif;
    font-weight: 700; font-size: 0.9rem; letter-spacing: 1px;
    text-transform: uppercase; transition: all 0.2s;
  }
  .admin-btn-primary { background: var(--accent-cyan); color: var(--bg-primary); }
  .admin-btn-primary:hover { background: #00b8db; }
  .admin-btn-danger { background: var(--accent-pink); color: white; }
  .admin-btn-danger:hover { opacity: 0.85; }
  .admin-btn-secondary { background: rgba(255,255,255,0.1); color: var(--text-primary); border: 1px solid var(--border-color); }
  .content-list-item {
    display: flex; align-items: center; gap: 1rem;
    padding: 0.75rem; border-radius: 8px;
    border: 1px solid var(--border-color);
    background: rgba(255,255,255,0.02);
    margin-bottom: 0.5rem;
  }
  .content-list-item img { width: 40px; height: 60px; object-fit: cover; border-radius: 4px; }
  .content-list-info { flex: 1; min-width: 0; }
  .content-list-title { font-weight: 600; font-size: 0.9rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .content-list-meta { font-size: 0.75rem; color: var(--text-muted); }

  .pw-screen {
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    min-height: 300px; gap: 1rem;
  }
  .pw-title {
    font-family: 'Bebas Neue', cursive; font-size: 1.5rem;
    color: var(--accent-cyan); letter-spacing: 3px;
  }
  .pw-error { color: var(--accent-pink); font-size: 0.85rem; }

  .tmdb-result {
    display: flex; gap: 1rem; padding: 0.75rem;
    border: 1px solid var(--border-color); border-radius: 8px;
    cursor: pointer; margin-bottom: 0.5rem;
    background: rgba(255,255,255,0.02);
    transition: border-color 0.2s;
  }
  .tmdb-result:hover { border-color: var(--accent-cyan); }
  .tmdb-result img { width: 50px; height: 75px; object-fit: cover; border-radius: 4px; }
  .tmdb-result-info { flex: 1; }
  .tmdb-result-title { font-weight: 600; margin-bottom: 0.25rem; }
  .tmdb-result-meta { font-size: 0.8rem; color: var(--text-muted); }

  .toast {
    position: fixed; bottom: 2rem; right: 2rem; z-index: 1000;
    background: var(--accent-cyan); color: var(--bg-primary);
    padding: 0.75rem 1.5rem; border-radius: 8px;
    font-weight: 700; font-size: 0.9rem; letter-spacing: 1px;
    transform: translateY(100px); opacity: 0;
    transition: all 0.3s; pointer-events: none;
  }
  .toast.show { transform: translateY(0); opacity: 1; }
  .toast.error { background: var(--accent-pink); color: white; }

  .empty-state {
    display: flex; flex-direction: column; align-items: center;
    padding: 4rem 2rem; color: var(--text-muted); gap: 1rem;
    text-align: center;
  }
  .empty-state-icon { font-size: 3rem; opacity: 0.4; }
  .empty-state-text { font-size: 1rem; opacity: 0.6; }

  .content-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 1rem;
    padding: 0 3rem 2rem;
  }
  .grid-card {
    cursor: pointer; transition: transform 0.2s;
    position: relative; border-radius: 10px; overflow: visible;
  }
  .grid-card:hover { transform: scale(1.05); z-index: 5; }

  @media (max-width: 768px) {
    .section { padding: 1.5rem 1rem; }
    .filter-tabs { padding: 1rem 1rem 0; }
    .nav-links { display: none; }
    .hero { height: 350px; }
    .hero-title { font-size: 2.5rem; }
    .hero-content { padding: 1.5rem 1rem; }
    .content-grid { padding: 0 1rem 2rem; }
  }

  .glow-cyan { box-shadow: 0 0 20px rgba(0,212,255,0.3); }
  .glow-pink { box-shadow: 0 0 20px rgba(255,0,110,0.3); }

  .particles { position: absolute; inset: 0; pointer-events: none; overflow: hidden; }
  .particle {
    position: absolute; border-radius: 50%;
    animation: float linear infinite;
    opacity: 0.15;
  }
  @keyframes float {
    0% { transform: translateY(100%) scale(0); opacity: 0; }
    10% { opacity: 0.15; }
    90% { opacity: 0.15; }
    100% { transform: translateY(-100vh) scale(1.5); opacity: 0; }
  }

  .card-overlay {
    position: absolute; inset: 0;
    border-radius: 10px;
    background: linear-gradient(0deg, rgba(0,212,255,0.15) 0%, transparent 60%);
    opacity: 0; transition: opacity 0.3s;
    display: flex; align-items: center; justify-content: center;
  }
  .trending-card:hover .card-overlay,
  .grid-card:hover .card-overlay { opacity: 1; }
  .play-icon {
    width: 48px; height: 48px;
    background: rgba(0,212,255,0.9);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    color: var(--bg-primary); font-size: 1.2rem;
    padding-left: 4px;
  }

  .section-divider {
    width: 40px; height: 3px;
    background: linear-gradient(90deg, var(--accent-cyan), transparent);
    border-radius: 2px; margin-left: 0.5rem;
  }

  .spinner {
    width: 24px; height: 24px;
    border: 2px solid var(--border-color);
    border-top-color: var(--accent-cyan);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    display: inline-block;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  .genre-badge {
    display: inline-block;
    background: rgba(0,212,255,0.1);
    border: 1px solid rgba(0,212,255,0.2);
    color: var(--accent-cyan);
    font-size: 0.7rem; font-weight: 700; letter-spacing: 1px;
    padding: 2px 8px; border-radius: 50px;
    text-transform: uppercase;
  }

  /* ===== WIZARD √âPISODES ===== */
  .wizard-overlay {
    position: fixed; inset: 0; z-index: 600;
    background: rgba(0,0,0,0.92);
    backdrop-filter: blur(16px);
    display: flex; align-items: center; justify-content: center;
    padding: 1rem;
  }
  .wizard-overlay.hidden { display: none; }
  .wizard-panel {
    background: var(--bg-secondary);
    border: 1px solid rgba(0,212,255,0.3);
    border-radius: 20px;
    width: 100%;
    max-width: 680px;
    max-height: 88vh;
    overflow-y: auto;
    padding: 2rem;
    box-shadow: 0 0 80px rgba(0,212,255,0.12);
  }
  .wizard-header {
    display: flex; align-items: center; gap: 1rem;
    margin-bottom: 1.5rem;
  }
  .wizard-step-badge {
    background: var(--accent-cyan); color: var(--bg-primary);
    font-family: 'Bebas Neue', cursive; font-size: 1rem; letter-spacing: 2px;
    padding: 0.2rem 0.75rem; border-radius: 50px;
    flex-shrink: 0;
  }
  .wizard-title {
    font-family: 'Bebas Neue', cursive;
    font-size: 1.4rem; letter-spacing: 2px;
    background: linear-gradient(135deg, var(--accent-cyan), var(--accent-pink));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  }
  .wizard-progress {
    width: 100%; height: 4px;
    background: var(--border-color);
    border-radius: 2px; margin-bottom: 1.5rem; overflow: hidden;
  }
  .wizard-progress-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--accent-cyan), var(--accent-pink));
    border-radius: 2px;
    transition: width 0.4s ease;
  }
  .ep-link-row {
    display: grid;
    grid-template-columns: auto 1fr;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
    align-items: center;
  }
  .ep-number-badge {
    background: rgba(0,212,255,0.1);
    border: 1px solid rgba(0,212,255,0.3);
    color: var(--accent-cyan);
    font-family: 'Bebas Neue', cursive;
    font-size: 0.95rem; letter-spacing: 1px;
    padding: 0.6rem 0.75rem; border-radius: 8px;
    text-align: center; min-width: 56px;
    white-space: nowrap;
  }
  .ep-link-row.current .ep-number-badge {
    background: var(--accent-cyan); color: var(--bg-primary);
    box-shadow: 0 0 12px rgba(0,212,255,0.4);
  }
  .ep-link-row.done .ep-number-badge {
    background: rgba(0,255,136,0.15); border-color: rgba(0,255,136,0.4);
    color: var(--accent-green);
  }
  .ep-sources-container {
    display: flex; flex-direction: column; gap: 0.4rem;
    flex: 1;
  }
  .ep-source-row {
    display: flex; gap: 0.4rem; align-items: center;
  }
</style>
</head>
<body>

<nav class="navbar">
  <div class="logo" onclick="showSection('home')" style="display:flex;align-items:center;gap:0.6rem;-webkit-text-fill-color:unset;background:none;">
    <img src="https://media.discordapp.net/attachments/1457377190110040309/1466842441264140431/LuaGen.webp?ex=6997437a&is=6995f1fa&hm=b679a2f2b0cad748f0ba661e99f56ee7095a356cfcbf86886a702902fd869cc4&=&format=webp" alt="Neya" style="width:36px;height:36px;border-radius:50%;object-fit:cover;">
    <span style="font-family:'Bebas Neue',cursive;font-size:1.8rem;letter-spacing:2px;background:linear-gradient(135deg,var(--accent-cyan),var(--accent-pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;">NEYA</span>
  </div>
  <div class="nav-links">
    <span class="nav-link active" id="nav-home" onclick="showSection('home')">üè† Accueil</span>
    <span class="nav-link" id="nav-films" onclick="filterCategory('film')">üé¨ Films</span>
    <span class="nav-link" id="nav-series" onclick="filterCategory('series')">üì∫ S√©ries</span>
    <span class="nav-link" id="nav-animes" onclick="filterCategory('anime')">‚õ©Ô∏è Anim√©s</span>
  </div>
  <div class="nav-right">
    <div class="search-box">
      <svg width="14" height="14" fill="none" stroke="#7986cb" stroke-width="2" viewBox="0 0 24 24">
        <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
      </svg>
      <input type="text" id="searchInput" placeholder="Rechercher..." oninput="handleSearch(this.value)">
    </div>
    <div style="width:36px;height:36px;background:rgba(0,212,255,0.1);border:1px solid var(--border-color);border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:1rem;" title="Visiteur">üë§</div>
  </div>
</nav>

<main id="mainContent">

  <div id="section-home">
    <div class="hero" id="heroSection">
      <div class="hero-bg"></div>
      <div class="hero-grid"></div>
      <div class="particles" id="heroParticles"></div>
      <div class="hero-content" id="heroContent">
        <div class="hero-badge">üî• Trending</div>
        <div class="hero-title" id="heroTitle">D√©couvrez les meilleurs films</div>
        <div class="hero-meta" id="heroMeta">Ajoutez du contenu pour commencer</div>
        <div class="hero-desc" id="heroDesc">Profitez d'une exp√©rience de streaming immersive avec les derniers films, s√©ries et anim√©s.</div>
        <div>
          <button class="btn-primary" id="heroPlayBtn" onclick="heroPlay()">‚ñ∂ Regarder</button>
          <button class="btn-secondary" id="heroInfoBtn">‚Ñπ Plus d'infos</button>
        </div>
      </div>
    </div>

    <div class="filter-tabs">
      <button class="filter-tab active" id="tab-all" onclick="setTab('all')">Tout</button>
      <button class="filter-tab" id="tab-film" onclick="setTab('film')">Films</button>
      <button class="filter-tab" id="tab-series" onclick="setTab('series')">S√©ries</button>
      <button class="filter-tab" id="tab-anime" onclick="setTab('anime')">Anim√©s</button>
    </div>

    <section class="section" id="section-films-tendances">
      <div class="section-header">
        <span class="section-icon">üî•</span>
        <span class="section-title">Films Tendances</span>
        <div class="section-divider"></div>
      </div>
      <div class="cards-row" id="filmsTendancesRow"></div>
    </section>

    <section class="section" id="section-series-populaires">
      <div class="section-header">
        <span class="section-icon">üì∫</span>
        <span class="section-title">S√©ries Populaires</span>
        <div class="section-divider" style="background:linear-gradient(90deg,var(--accent-green),transparent)"></div>
      </div>
      <div class="cards-row" id="seriesPopulairesRow"></div>
    </section>

    <section class="section" id="section-animes-moment">
      <div class="section-header">
        <span class="section-icon">‚õ©Ô∏è</span>
        <span class="section-title">Anim√©s du Moment</span>
        <div class="section-divider" style="background:linear-gradient(90deg,var(--accent-pink),transparent)"></div>
      </div>
      <div class="cards-row" id="animesRow"></div>
    </section>
  </div>

  <div id="section-search" class="hidden" style="padding-top:80px;">
    <div class="section" style="padding-bottom:0.5rem;">
      <div class="section-header">
        <span class="section-icon">üîç</span>
        <span class="section-title">R√©sultats de recherche</span>
        <span id="searchCount" style="color:var(--text-muted);font-size:0.85rem;margin-left:0.5rem;"></span>
      </div>
    </div>
    <div class="content-grid" id="searchResults"></div>
  </div>

  <div id="section-category" class="hidden" style="padding-top:80px;">
    <div class="section" style="padding-bottom:0.5rem;">
      <div class="section-header">
        <span class="section-icon" id="categoryIcon">üé¨</span>
        <span class="section-title" id="categoryTitle">Films</span>
        <div class="section-divider"></div>
      </div>
    </div>
    <div class="content-grid" id="categoryResults"></div>
  </div>

</main>

<!-- VIDEO MODAL -->
<div class="modal-overlay hidden" id="videoModal">
  <div class="modal" style="max-width:900px;">
    <button class="modal-close" onclick="closeModal('videoModal')">‚úï</button>
    <div class="modal-player" id="modalPlayer"></div>
    <div class="modal-body">
      <div style="display:flex;gap:1rem;align-items:flex-start;flex-wrap:wrap;">
        <img id="modalPoster" src="" alt="" style="width:80px;height:120px;object-fit:cover;border-radius:8px;flex-shrink:0;" onerror="this.style.display='none'">
        <div style="flex:1;min-width:0;">
          <div style="display:flex;align-items:center;gap:0.75rem;flex-wrap:wrap;margin-bottom:0.5rem;">
            <div class="modal-title" id="modalTitle"></div>
            <span id="modalRating" style="color:var(--accent-yellow);font-weight:700;"></span>
          </div>
          <div style="display:flex;gap:0.5rem;flex-wrap:wrap;margin-bottom:0.75rem;" id="modalBadges"></div>
          <div class="modal-desc" id="modalDesc"></div>
        </div>
      </div>

      <!-- S√âLECTEUR DE SAISON (affich√© seulement si plusieurs saisons) -->
      <div id="seasonSelectorContainer" class="hidden" style="margin-top:1.25rem;">
        <div class="admin-label" style="margin-bottom:0.5rem;">üìÇ Choisir une saison</div>
        <div class="season-selector" id="seasonSelector"></div>
      </div>

      <div id="episodeSelector" class="hidden" style="margin-top:1rem;">
        <div class="admin-label">Choisir un √©pisode</div>
        <div style="display:flex;gap:0.5rem;flex-wrap:wrap;margin-top:0.5rem;" id="episodeList"></div>
      </div>
    </div>
  </div>
</div>

<!-- ADMIN LOGIN -->
<div class="admin-overlay hidden" id="adminLoginOverlay">
  <div class="admin-panel" style="max-width:420px;">
    <div class="pw-screen">
      <div style="font-size:3rem;">üîê</div>
      <div class="pw-title">ACC√àS RESTREINT</div>
      <p style="color:var(--text-muted);font-size:0.85rem;text-align:center;">Panel d'administration Neya</p>
      <div style="width:100%;max-width:300px;">
        <input type="password" id="adminPasswordInput" class="admin-input" placeholder="Mot de passe" onkeydown="if(event.key==='Enter')checkAdminPassword()">
      </div>
      <div style="display:flex;gap:0.75rem;">
        <button class="admin-btn admin-btn-primary" onclick="checkAdminPassword()">Connexion</button>
        <button class="admin-btn admin-btn-secondary" onclick="closeModal('adminLoginOverlay')">Annuler</button>
      </div>
      <div class="pw-error hidden" id="pwError">‚ùå Mot de passe incorrect</div>
    </div>
  </div>
</div>

<!-- ADMIN PANEL -->
<div class="admin-overlay hidden" id="adminPanelOverlay">
  <div class="admin-panel">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;">
      <div class="admin-title">‚öôÔ∏è PANEL ADMIN ‚Äî NEYA</div>
      <button class="modal-close" style="position:static;" onclick="closeModal('adminPanelOverlay')">‚úï</button>
    </div>

    <!-- TMDB SEARCH -->
    <div style="background:rgba(0,212,255,0.05);border:1px solid rgba(0,212,255,0.15);border-radius:12px;padding:1.5rem;margin-bottom:1.5rem;">
      <div style="font-family:'Bebas Neue',cursive;letter-spacing:2px;margin-bottom:1rem;color:var(--accent-cyan);">üîç RECHERCHE TMDB</div>
      <div style="display:flex;gap:0.75rem;">
        <input type="text" id="tmdbSearchInput" class="admin-input" placeholder="Titre du film/s√©rie..." style="flex:1;" onkeydown="if(event.key==='Enter')searchTMDB()">
        <select id="tmdbTypeSelect" class="admin-select" style="width:130px;">
          <option value="movie">Film</option>
          <option value="tv">S√©rie/Anim√©</option>
        </select>
        <button class="admin-btn admin-btn-primary" onclick="searchTMDB()" id="tmdbSearchBtn">Chercher</button>
      </div>
      <div id="tmdbResults" style="margin-top:1rem;max-height:250px;overflow-y:auto;"></div>
    </div>

    <!-- DISCORD WEBHOOK -->
    <div style="background:rgba(114,137,218,0.07);border:1px solid rgba(114,137,218,0.25);border-radius:12px;padding:1.5rem;margin-bottom:1.5rem;">
      <div style="font-family:'Bebas Neue',cursive;letter-spacing:2px;margin-bottom:0.75rem;color:#7289da;">
        <img src="https://cdn.prod.website-files.com/6257adef93867e50d84d30e2/636e0a6a49cf127bf92de1e2_icon_clyde_blurple_RGB.png" style="width:18px;height:18px;vertical-align:middle;margin-right:6px;border-radius:3px;">
        NOTIFICATIONS DISCORD
      </div>
      <div style="margin-bottom:0.75rem;">
        <label class="admin-label">URL du Webhook Discord</label>
        <div style="display:flex;gap:0.5rem;">
          <input type="text" id="webhookUrl" class="admin-input" placeholder="https://discord.com/api/webhooks/..." style="flex:1;">
          <button class="admin-btn admin-btn-secondary" onclick="testWebhook()" style="white-space:nowrap;font-size:0.8rem;">üîî Tester</button>
          <button class="admin-btn admin-btn-primary" onclick="saveWebhook()" style="white-space:nowrap;font-size:0.8rem;">üíæ Sauver</button>
        </div>
      </div>
      <div id="webhookStatus" style="font-size:0.78rem;color:var(--text-muted);"></div>
    </div>

    <!-- AJOUTER DU CONTENU -->
    <div style="background:rgba(255,255,255,0.02);border:1px solid var(--border-color);border-radius:12px;padding:1.5rem;margin-bottom:1.5rem;">
      <div style="font-family:'Bebas Neue',cursive;letter-spacing:2px;margin-bottom:1rem;">‚ûï AJOUTER DU CONTENU</div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1rem;">
        <div>
          <label class="admin-label">Titre *</label>
          <input type="text" id="formTitle" class="admin-input" placeholder="Ex: Naruto">
        </div>
        <div>
          <label class="admin-label">Type *</label>
          <select id="formType" class="admin-select" onchange="updateFormType()">
            <option value="film">Film</option>
            <option value="series">S√©rie</option>
            <option value="anime">Anim√©</option>
          </select>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:1rem;margin-bottom:1rem;">
        <div>
          <label class="admin-label">Ann√©e</label>
          <input type="number" id="formYear" class="admin-input" placeholder="2024">
        </div>
        <div>
          <label class="admin-label">Note TMDB</label>
          <input type="number" id="formRating" class="admin-input" placeholder="7.5" step="0.1" min="0" max="10">
        </div>
        <div>
          <label class="admin-label">Genre</label>
          <input type="text" id="formGenre" class="admin-input" placeholder="Action, Thriller...">
        </div>
      </div>

      <div id="episodeFields" class="hidden" style="display:none;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1rem;">
        <div>
          <label class="admin-label">Saison</label>
          <input type="number" id="formSeason" class="admin-input" placeholder="1" value="1" min="1">
        </div>
        <div>
          <label class="admin-label">Nombre total d'√©pisodes *</label>
          <input type="number" id="formEpisode" class="admin-input" placeholder="12" value="1" min="1">
        </div>
      </div>

      <div style="margin-bottom:1rem;">
        <label class="admin-label">Synopsis</label>
        <textarea id="formSynopsis" class="admin-input" rows="3" placeholder="Synopsis du contenu..." style="resize:vertical;"></textarea>
      </div>

      <div style="margin-bottom:1rem;">
        <label class="admin-label">Affiche URL (poster)</label>
        <input type="text" id="formPoster" class="admin-input" placeholder="https://image.tmdb.org/...">
      </div>

      <div style="margin-bottom:1rem;">
        <label class="admin-label">TMDB ID</label>
        <input type="text" id="formTmdbId" class="admin-input" placeholder="123456 (optionnel)">
      </div>

      <div id="filmLinksSection">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.5rem;">
          <label class="admin-label" style="margin:0;">Liens de lecture *</label>
          <button type="button" class="admin-btn admin-btn-secondary" onclick="addLinkRow()" style="font-size:0.75rem;padding:0.3rem 0.75rem;">+ Ajouter un lien</button>
        </div>
        <div id="linkRows">
          <div class="link-row" style="display:flex;gap:0.5rem;margin-bottom:0.5rem;align-items:center;">
            <input type="text" class="admin-input link-label" placeholder="Nom (ex: VF, VOSTFR, uqload...)" style="flex:0 0 180px;">
            <input type="text" class="admin-input link-url" placeholder="https://..." style="flex:1;">
            <button type="button" onclick="removeLinkRow(this)" style="background:rgba(255,0,110,0.15);border:1px solid var(--accent-pink);color:var(--accent-pink);width:32px;height:32px;border-radius:6px;cursor:pointer;flex-shrink:0;font-size:1rem;">‚úï</button>
          </div>
        </div>
      </div>

      <div id="seriesLinksSection" class="hidden" style="margin-bottom:1.5rem;">
        <div style="background:rgba(0,212,255,0.06);border:1px dashed rgba(0,212,255,0.3);border-radius:10px;padding:1rem;text-align:center;">
          <div style="font-size:0.85rem;color:var(--text-muted);margin-bottom:0.75rem;">
            Les liens des √©pisodes seront saisis un par un apr√®s validation des infos.<br>
            <span style="color:var(--accent-cyan);font-weight:700;">Entrez d'abord le nombre total d'√©pisodes ci-dessus.</span>
          </div>
        </div>
      </div>

      <div style="display:flex;justify-content:flex-end;gap:0.75rem;">
        <button class="admin-btn admin-btn-secondary" onclick="resetForm()">R√©initialiser</button>
        <button class="admin-btn admin-btn-primary" onclick="addContent()" id="addContentBtn">
          <span id="addContentBtnText">Ajouter le contenu</span>
        </button>
      </div>
    </div>

    <!-- DOMAIN REPLACE -->
    <div style="background:rgba(255,214,0,0.05);border:1px solid rgba(255,214,0,0.2);border-radius:12px;padding:1.5rem;margin-bottom:1.5rem;">
      <div style="font-family:'Bebas Neue',cursive;letter-spacing:2px;margin-bottom:0.5rem;color:var(--accent-yellow);">üîó REMPLACEMENT DE DOMAINE</div>
      <p style="font-size:0.8rem;color:var(--text-muted);margin-bottom:1rem;">Remplace le domaine de tous les liens en une seule fois.</p>
      <div style="display:grid;grid-template-columns:1fr 1fr auto;gap:0.75rem;align-items:end;">
        <div>
          <label class="admin-label">Ancien domaine</label>
          <input type="text" id="domainOld" class="admin-input" placeholder="ex: uqload.is" oninput="previewDomain()">
        </div>
        <div>
          <label class="admin-label">Nouveau domaine</label>
          <input type="text" id="domainNew" class="admin-input" placeholder="ex: uqload.cx" oninput="previewDomain()">
        </div>
        <button class="admin-btn admin-btn-primary" onclick="replaceDomain()" style="white-space:nowrap;">üîÑ Remplacer</button>
      </div>
      <div id="domainPreview" style="margin-top:0.75rem;font-size:0.8rem;color:var(--text-muted);min-height:1.2rem;"></div>
    </div>

    <!-- CONTENT LIST -->
    <div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;">
        <div style="font-family:'Bebas Neue',cursive;letter-spacing:2px;">üìã CONTENUS ENREGISTR√âS (<span id="contentCountAdmin">0</span>)</div>
        <button class="admin-btn admin-btn-danger" onclick="clearAllContent()" style="font-size:0.75rem;padding:0.4rem 0.75rem;">üóë Tout supprimer</button>
      </div>
      <div id="adminContentList"></div>
    </div>
  </div>
</div>

<!-- ===== WIZARD √âPISODES ===== -->
<div class="wizard-overlay hidden" id="episodeWizardOverlay">
  <div class="wizard-panel">
    <div class="wizard-header">
      <div class="wizard-step-badge" id="wizardStepBadge">EP 1</div>
      <div class="wizard-title" id="wizardTitle">LIENS DES √âPISODES</div>
    </div>
    <div class="wizard-progress">
      <div class="wizard-progress-bar" id="wizardProgressBar" style="width:0%"></div>
    </div>
    <div id="wizardRecap" style="background:rgba(0,212,255,0.05);border:1px solid rgba(0,212,255,0.15);border-radius:10px;padding:0.85rem 1rem;margin-bottom:1.25rem;font-size:0.85rem;color:var(--text-muted);"></div>
    <div id="wizardEpisodesContainer"></div>
    <div style="display:flex;justify-content:space-between;align-items:center;gap:0.75rem;margin-top:1.5rem;">
      <button class="admin-btn admin-btn-danger" onclick="cancelWizard()" style="font-size:0.8rem;padding:0.5rem 1rem;">‚úï Annuler</button>
      <div style="display:flex;gap:0.75rem;">
        <button class="admin-btn admin-btn-secondary" id="wizardSkipBtn" onclick="wizardSkipCurrent()" style="font-size:0.8rem;padding:0.5rem 1rem;">‚è≠ Passer</button>
        <button class="admin-btn admin-btn-primary" id="wizardNextBtn" onclick="wizardNext()">
          <span id="wizardNextBtnText">Suivant ‚ñ∂</span>
        </button>
      </div>
    </div>
    <div style="margin-top:1rem;font-size:0.75rem;color:var(--text-muted);text-align:center;">
      üí° Vous pouvez ajouter plusieurs sources par √©pisode (VF, VOSTFR...) ‚Ä¢ "Passer" laisse l'√©pisode sans lien
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>
<div id="hiddenAdminTrigger" style="position:fixed;bottom:0;left:0;width:20px;height:20px;z-index:9999;cursor:default;" onclick="openAdminLogin()"></div>

<script>
const TMDB_API_KEY = '8265bd1679663a7ea12ac168da84d2e8';
const TMDB_BASE = 'https://api.themoviedb.org/3';
const TMDB_IMG = 'https://image.tmdb.org/t/p/w500';
const ADMIN_PASSWORD_HASH = 'a704c12a057999076377e246e5557f8130e851d7e8503729f1c176b24977d4fb';

let currentHeroItem = null;
let currentTab = 'all';
let adminAuthenticated = false;
let wizardData = null;

// =============================================
// REGROUPEMENT PAR TITRE (m√™me s√©rie, N saisons)
// =============================================

/**
 * Regroupe les items s√©ries/anim√©s qui ont le m√™me titre en un seul objet
 * avec un tableau `seasons` contenant chaque saison.
 * Les films ne sont pas regroup√©s.
 */
function groupContentByTitle(items) {
  const groups = [];
  const seen = {}; // cl√© = "type::titreNormalis√©"

  items.forEach(item => {
    if (item.type === 'film') {
      groups.push(item);
      return;
    }
    const key = item.type + '::' + item.title.toLowerCase().trim();
    if (seen[key] !== undefined) {
      // Ajouter la saison au groupe existant
      groups[seen[key]].seasons.push(item);
      // Garder la meilleure note et le poster de la derni√®re saison si dispo
      if ((item.rating || 0) > (groups[seen[key]].rating || 0)) {
        groups[seen[key]].rating = item.rating;
      }
    } else {
      seen[key] = groups.length;
      // Cr√©er un objet "groupe"
      const grouped = { ...item, seasons: [item], _grouped: true };
      groups.push(grouped);
    }
  });

  // Trier les saisons dans chaque groupe
  groups.forEach(g => {
    if (g.seasons) g.seasons.sort((a, b) => (a.season || 1) - (b.season || 1));
  });

  return groups;
}

// =============================================

async function sha256(message) {
  const msgBuffer = new TextEncoder().encode(message);
  const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
  return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');
}

function getContent() {
  try { return JSON.parse(localStorage.getItem('neya_content') || '[]'); } catch { return []; }
}
function saveContent(data) { localStorage.setItem('neya_content', JSON.stringify(data)); }

function showToast(msg, type = 'success') {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = 'toast' + (type === 'error' ? ' error' : '');
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}

function updateHero() {
  const content = getContent();
  if (!content.length) return;
  const sorted = [...content].sort((a, b) => (b.rating || 0) - (a.rating || 0));
  const item = sorted[0];
  currentHeroItem = item;
  document.getElementById('heroTitle').textContent = item.title;
  document.getElementById('heroMeta').textContent = `${item.year || ''} ‚Ä¢ ${item.genre || ''} ‚Ä¢ ‚≠ê ${item.rating || 'N/A'}`;
  document.getElementById('heroDesc').textContent = item.synopsis || '';
  if (item.poster) {
    const h = document.getElementById('heroSection');
    h.style.backgroundImage = `url(${item.poster})`;
    h.style.backgroundSize = 'cover';
    h.style.backgroundPosition = 'center';
  }
}
function heroPlay() { if (currentHeroItem) openVideoModal(currentHeroItem); }

function createParticles() {
  const container = document.getElementById('heroParticles');
  if (!container) return;
  for (let i = 0; i < 15; i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    const size = Math.random() * 4 + 2;
    p.style.cssText = `width:${size}px;height:${size}px;left:${Math.random()*100}%;bottom:-20px;background:${Math.random()>0.5?'var(--accent-cyan)':'var(--accent-pink)'};animation-duration:${Math.random()*10+8}s;animation-delay:${Math.random()*10}s;`;
    container.appendChild(p);
  }
}

function getBadgeHtml(item) { return `<div class="badge-hd">HD</div>`; }

// Carte qui supporte les groupes (plusieurs saisons)
function buildCard(groupedItem, index, colorStroke) {
  const item = groupedItem;
  const seasons = item.seasons || [item];
  const hasMultipleSeasons = seasons.length > 1;

  const posterHtml = item.poster
    ? `<img src="${item.poster}" alt="${item.title}" class="trending-poster" onerror="this.parentElement.innerHTML='<div class=\\'trending-poster-placeholder\\'>üé¨</div>'">`
    : `<div class="trending-poster-placeholder">üé¨</div>`;

  const seasonsBadge = hasMultipleSeasons
    ? `<div class="badge-seasons">${seasons.length} SAISONS</div>` : '';

  const itemJson = JSON.stringify(groupedItem).replace(/'/g, "&#39;");

  return `
    <div class="trending-card" onclick='openVideoModal(${itemJson})'>
      <div style="position:relative;">
        ${posterHtml}
        ${seasonsBadge}
        ${getBadgeHtml(item)}
        <div class="card-overlay"><div class="play-icon">‚ñ∂</div></div>
      </div>
      <div class="trending-number" style="-webkit-text-stroke-color:${colorStroke}">${index+1}</div>
      <div class="trending-info">
        <div class="trending-title">${item.title}</div>
        <div class="trending-meta-row">
          <div class="trending-year">${hasMultipleSeasons ? `S1‚ÄìS${seasons.length}` : (item.year||'')}</div>
          <div class="trending-rating">‚≠ê ${item.rating||'N/A'}</div>
        </div>
      </div>
    </div>`;
}

function renderRows(tab = 'all') {
  const content = getContent();

  // Films (pas regroup√©s)
  const films = content.filter(c => c.type === 'film' && (tab === 'all' || tab === 'film'))
    .sort((a, b) => (b.rating || 0) - (a.rating || 0));
  const filmsRow = document.getElementById('filmsTendancesRow');
  const filmSection = document.getElementById('section-films-tendances');
  if (films.length > 0) {
    filmsRow.innerHTML = films.map((f, i) => buildCard(f, i, 'var(--accent-pink)')).join('');
    filmSection.style.display = '';
  } else if (tab === 'all' || tab === 'film') {
    filmsRow.innerHTML = `<div class="empty-state"><div class="empty-state-icon">üé¨</div><div class="empty-state-text">Aucun film ajout√©</div></div>`;
    filmSection.style.display = '';
  } else { filmSection.style.display = 'none'; }

  // S√©ries (regroup√©es par titre)
  const seriesRaw = content.filter(c => c.type === 'series' && (tab === 'all' || tab === 'series'));
  const series = groupContentByTitle(seriesRaw).sort((a, b) => (b.rating || 0) - (a.rating || 0));
  const seriesRow = document.getElementById('seriesPopulairesRow');
  const seriesSection = document.getElementById('section-series-populaires');
  if (series.length > 0) {
    seriesRow.innerHTML = series.map((s, i) => buildCard(s, i, 'var(--accent-green)')).join('');
    seriesSection.style.display = '';
  } else if (tab === 'all' || tab === 'series') {
    seriesRow.innerHTML = `<div class="empty-state"><div class="empty-state-icon">üì∫</div><div class="empty-state-text">Aucune s√©rie ajout√©e</div></div>`;
    seriesSection.style.display = '';
  } else { seriesSection.style.display = 'none'; }

  // Anim√©s (regroup√©s par titre)
  const animesRaw = content.filter(c => c.type === 'anime' && (tab === 'all' || tab === 'anime'));
  const animes = groupContentByTitle(animesRaw).sort((a, b) => (b.rating || 0) - (a.rating || 0));
  const animesRow = document.getElementById('animesRow');
  const animeSection = document.getElementById('section-animes-moment');
  if (animes.length > 0) {
    animesRow.innerHTML = animes.map((a, i) => buildCard(a, i, 'var(--accent-cyan)')).join('');
    animeSection.style.display = '';
  } else if (tab === 'all' || tab === 'anime') {
    animesRow.innerHTML = `<div class="empty-state"><div class="empty-state-icon">‚õ©Ô∏è</div><div class="empty-state-text">Aucun anim√© ajout√©</div></div>`;
    animeSection.style.display = '';
  } else { animeSection.style.display = 'none'; }
}

function setTab(tab) {
  currentTab = tab;
  document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
  document.getElementById('tab-' + tab)?.classList.add('active');
  showSection('home');
  renderRows(tab);
}

function showSection(name) {
  document.getElementById('section-home').classList.toggle('hidden', name !== 'home');
  document.getElementById('section-search').classList.toggle('hidden', name !== 'search');
  document.getElementById('section-category').classList.toggle('hidden', name !== 'category');
  if (name !== 'search') document.getElementById('searchInput').value = '';
}

function filterCategory(type) { setTab(type); }

function handleSearch(query) {
  if (!query.trim()) { showSection('home'); return; }
  const content = getContent();
  const results = groupContentByTitle(content.filter(c => c.title.toLowerCase().includes(query.toLowerCase())));
  showSection('search');
  document.getElementById('searchCount').textContent = `(${results.length} r√©sultat${results.length !== 1 ? 's' : ''})`;
  const container = document.getElementById('searchResults');
  if (results.length === 0) {
    container.innerHTML = `<div style="grid-column:1/-1;"><div class="empty-state"><div class="empty-state-icon">üîç</div><div class="empty-state-text">Aucun r√©sultat pour "${query}"</div></div></div>`;
    return;
  }
  container.innerHTML = results.map(item => {
    const seasons = item.seasons || [item];
    const hasMultiple = seasons.length > 1;
    const poster = item.poster
      ? `<img src="${item.poster}" alt="${item.title}" style="width:100%;aspect-ratio:2/3;object-fit:cover;border-radius:10px;border:1px solid var(--border-color);" onerror="this.src=''">`
      : `<div style="width:100%;aspect-ratio:2/3;background:var(--bg-card);border-radius:10px;border:1px solid var(--border-color);display:flex;align-items:center;justify-content:center;font-size:2rem;">üé¨</div>`;
    return `
      <div class="grid-card" onclick='openVideoModal(${JSON.stringify(item).replace(/'/g,"&#39;")})'>
        <div style="position:relative;">${poster}${hasMultiple?`<div class="badge-seasons">${seasons.length} SAISONS</div>`:''}<div class="badge-hd">HD</div><div class="card-overlay"><div class="play-icon">‚ñ∂</div></div></div>
        <div style="margin-top:0.5rem;">
          <div style="font-size:0.85rem;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${item.title}</div>
          <div style="font-size:0.75rem;color:var(--text-muted);display:flex;justify-content:space-between;">
            <span>${hasMultiple ? `S1‚ÄìS${seasons.length}` : (item.year||'')}</span>
            <span style="color:var(--accent-yellow);">‚≠ê ${item.rating||'N/A'}</span>
          </div>
        </div>
      </div>`;
  }).join('');
}

let _hlsInstance = null;
function destroyHls() { if (_hlsInstance) { _hlsInstance.destroy(); _hlsInstance = null; } }

function buildPlayer(url) {
  return `<iframe id="mainIframe" src="${url}" allowfullscreen allow="autoplay; encrypted-media; fullscreen; picture-in-picture" style="width:100%;height:100%;border:none;"></iframe>`;
}

// =============================================
// MODAL VID√âO avec support multi-saisons
// =============================================
function openVideoModal(item) {
  document.getElementById('modalTitle').textContent = item.title;
  document.getElementById('modalRating').textContent = item.rating ? `‚≠ê ${item.rating}` : '';
  document.getElementById('modalDesc').textContent = item.synopsis || '';
  document.getElementById('modalPoster').src = item.poster || '';

  const badges = document.getElementById('modalBadges');
  badges.innerHTML = '';
  if (item.genre) badges.innerHTML += `<span class="genre-badge">${item.genre}</span>`;
  if (item.year) badges.innerHTML += `<span class="genre-badge" style="color:var(--text-muted);background:rgba(255,255,255,0.05);border-color:rgba(255,255,255,0.1);">${item.year}</span>`;
  badges.innerHTML += `<span class="genre-badge" style="color:var(--accent-cyan);background:rgba(0,212,255,0.1);border-color:rgba(0,212,255,0.2);">HD</span>`;

  const seasons = item.seasons || [item];
  const seasonContainer = document.getElementById('seasonSelectorContainer');
  const seasonSelector = document.getElementById('seasonSelector');

  if (seasons.length > 1) {
    // Afficher le s√©lecteur de saison
    seasonContainer.classList.remove('hidden');
    seasonSelector.innerHTML = '';
    seasons.forEach((s, i) => {
      const btn = document.createElement('button');
      btn.className = 'season-btn' + (i === 0 ? ' active' : '');
      btn.textContent = `Saison ${s.season || (i + 1)}`;
      btn.onclick = () => {
        seasonSelector.querySelectorAll('.season-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        loadSeasonInModal(s);
      };
      seasonSelector.appendChild(btn);
    });
    // Charger la saison 1 par d√©faut
    loadSeasonInModal(seasons[0]);
  } else {
    seasonContainer.classList.add('hidden');
    loadSeasonInModal(seasons[0]);
  }

  document.getElementById('videoModal').classList.remove('hidden');
  document.body.style.overflow = 'hidden';
}

function loadSeasonInModal(item) {
  const epSelector = document.getElementById('episodeSelector');
  const epList = document.getElementById('episodeList');

  // Nettoyer sources pr√©c√©dentes
  const old = document.getElementById('episodeSources');
  if (old) old.remove();

  if ((item.type === 'series' || item.type === 'anime') && item.episodeLinks && item.episodeLinks.length > 0) {
    const firstEp = item.episodeLinks.find(e => e.links && e.links.length > 0);
    const firstLinks = firstEp ? firstEp.links : [];
    document.getElementById('modalPlayer').innerHTML = firstLinks.length > 0
      ? buildPlayer(firstLinks[0].url)
      : `<div style="display:flex;align-items:center;justify-content:center;height:100%;color:var(--text-muted);flex-direction:column;gap:1rem;"><span style="font-size:2rem;">üì∫</span><span>S√©lectionnez un √©pisode</span></div>`;

    epSelector.classList.remove('hidden');
    epList.innerHTML = `<div style="width:100%;margin-bottom:0.75rem;"><span style="font-size:0.75rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px;font-weight:700;">üì∫ Choisir un √©pisode</span></div>`;

    item.episodeLinks.forEach((epData, i) => {
      const hasLinks = epData.links && epData.links.length > 0;
      const btn = document.createElement('button');
      btn.className = 'admin-btn ' + (i === 0 && hasLinks ? 'admin-btn-primary' : 'admin-btn-secondary');
      btn.style.cssText = `font-size:0.8rem;padding:0.4rem 0.75rem;${!hasLinks ? 'opacity:0.4;cursor:not-allowed;' : ''}`;
      btn.innerHTML = `E${epData.ep}`;
      btn.title = hasLinks ? `${epData.links.length} source(s)` : 'Aucun lien';
      if (hasLinks) {
        btn.onclick = () => {
          document.getElementById('modalPlayer').innerHTML = buildPlayer(epData.links[0].url);
          if (epData.links.length > 1) {
            const srcDiv = document.getElementById('episodeSources');
            if (srcDiv) srcDiv.remove();
            const sd = document.createElement('div');
            sd.id = 'episodeSources';
            sd.style.cssText = 'display:flex;gap:0.4rem;flex-wrap:wrap;margin-top:0.5rem;';
            sd.innerHTML = `<span style="font-size:0.7rem;color:var(--text-muted);font-weight:700;letter-spacing:1px;align-self:center;">SOURCES :</span>`;
            epData.links.forEach((lk, li) => {
              const sb = document.createElement('button');
              sb.className = 'admin-btn ' + (li === 0 ? 'admin-btn-primary' : 'admin-btn-secondary');
              sb.style.cssText = 'font-size:0.72rem;padding:0.25rem 0.7rem;';
              sb.textContent = lk.label || extractDomain(lk.url);
              sb.onclick = () => {
                document.getElementById('mainIframe').src = lk.url;
                sd.querySelectorAll('button').forEach(b => b.className = 'admin-btn admin-btn-secondary');
                sb.className = 'admin-btn admin-btn-primary';
              };
              sd.appendChild(sb);
            });
            epList.parentElement.insertBefore(sd, epList.nextSibling);
          } else {
            const srcDiv = document.getElementById('episodeSources');
            if (srcDiv) srcDiv.remove();
          }
          epList.querySelectorAll('button').forEach(b => { b.className = 'admin-btn admin-btn-secondary'; b.style.opacity = b.title === 'Aucun lien' ? '0.4' : '1'; });
          btn.className = 'admin-btn admin-btn-primary';
        };
      }
      epList.appendChild(btn);
    });
  } else {
    const links = item.links || (item.url ? [{ label: extractDomain(item.url), url: item.url }] : []);
    document.getElementById('modalPlayer').innerHTML = buildPlayer(links[0]?.url || '');
    if (links.length > 1) {
      epSelector.classList.remove('hidden');
      epList.innerHTML = `<div style="width:100%;margin-bottom:0.5rem;"><span style="font-size:0.75rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px;font-weight:700;">üîó Choisir la source</span></div>`;
      links.forEach((lk, i) => {
        const btn = document.createElement('button');
        btn.className = 'admin-btn ' + (i === 0 ? 'admin-btn-primary' : 'admin-btn-secondary');
        btn.style.cssText = 'font-size:0.8rem;padding:0.4rem 1rem;';
        btn.innerHTML = `<span style="opacity:0.6;margin-right:4px;">${i+1}.</span> ${lk.label || extractDomain(lk.url)}`;
        btn.onclick = () => {
          document.getElementById('mainIframe').src = lk.url;
          epList.querySelectorAll('button').forEach(b => b.className = 'admin-btn admin-btn-secondary');
          btn.className = 'admin-btn admin-btn-primary';
        };
        epList.appendChild(btn);
      });
    } else {
      epSelector.classList.add('hidden');
    }
  }
}

function closeModal(id) {
  document.getElementById(id).classList.add('hidden');
  document.body.style.overflow = '';
  if (id === 'videoModal') {
    destroyHls();
    document.getElementById('modalPlayer').innerHTML = '';
    const srcDiv = document.getElementById('episodeSources');
    if (srcDiv) srcDiv.remove();
  }
}

document.addEventListener('keydown', (e) => {
  if (e.ctrlKey && e.shiftKey && e.key === 'A') { e.preventDefault(); openAdminLogin(); }
});

function openAdminLogin() {
  if (adminAuthenticated) { openAdminPanel(); return; }
  document.getElementById('adminPasswordInput').value = '';
  document.getElementById('pwError').classList.add('hidden');
  document.getElementById('adminLoginOverlay').classList.remove('hidden');
  setTimeout(() => document.getElementById('adminPasswordInput').focus(), 100);
}

async function checkAdminPassword() {
  const pw = document.getElementById('adminPasswordInput').value;
  const hash = await sha256(pw);
  if (hash === ADMIN_PASSWORD_HASH) {
    adminAuthenticated = true;
    closeModal('adminLoginOverlay');
    openAdminPanel();
  } else {
    document.getElementById('pwError').classList.remove('hidden');
    document.getElementById('adminPasswordInput').value = '';
    document.getElementById('adminPasswordInput').focus();
  }
}

function openAdminPanel() {
  const saved = localStorage.getItem('neya_webhook');
  if (saved) {
    document.getElementById('webhookUrl').value = saved;
    document.getElementById('webhookStatus').innerHTML = `<span style="color:var(--accent-green);">‚úÖ Webhook actif</span>`;
  }
  refreshAdminList();
  document.getElementById('adminPanelOverlay').classList.remove('hidden');
  document.body.style.overflow = 'hidden';
}

async function searchTMDB() {
  const query = document.getElementById('tmdbSearchInput').value.trim();
  if (!query) return showToast('Entrez un titre', 'error');
  const type = document.getElementById('tmdbTypeSelect').value;
  const btn = document.getElementById('tmdbSearchBtn');
  const resultsDiv = document.getElementById('tmdbResults');
  btn.innerHTML = '<span class="spinner"></span>';
  btn.disabled = true;
  resultsDiv.innerHTML = '';
  try {
    const res = await fetch(`${TMDB_BASE}/search/${type}?api_key=${TMDB_API_KEY}&query=${encodeURIComponent(query)}&language=fr-FR`);
    const data = await res.json();
    if (!data.results || data.results.length === 0) {
      resultsDiv.innerHTML = `<div style="color:var(--text-muted);text-align:center;padding:1rem;">Aucun r√©sultat trouv√© sur TMDB</div>`;
      return;
    }
    resultsDiv.innerHTML = data.results.slice(0, 6).map(item => {
      const title = item.title || item.name;
      const year = (item.release_date || item.first_air_date || '').slice(0, 4);
      const poster = item.poster_path ? TMDB_IMG + item.poster_path : '';
      const rating = item.vote_average ? item.vote_average.toFixed(1) : 'N/A';
      return `
        <div class="tmdb-result" onclick='fillFormFromTMDB(${JSON.stringify({id:item.id,title,year,rating,poster,synopsis:item.overview,type:type==="movie"?"film":"series"}).replace(/'/g,"&#39;")})'>
          ${poster ? `<img src="${poster}" alt="${title}" onerror="this.style.display='none'">` : '<div style="width:50px;height:75px;background:var(--bg-card);border-radius:4px;display:flex;align-items:center;justify-content:center;">üé¨</div>'}
          <div class="tmdb-result-info">
            <div class="tmdb-result-title">${title}</div>
            <div class="tmdb-result-meta">${year} ‚Ä¢ ‚≠ê ${rating}</div>
            <div class="tmdb-result-meta" style="margin-top:0.25rem;font-size:0.75rem;">TMDB ID: ${item.id}</div>
          </div>
        </div>`;
    }).join('');
  } catch {
    resultsDiv.innerHTML = `<div style="color:var(--accent-pink);text-align:center;padding:1rem;">Erreur API TMDB.</div>`;
  } finally {
    btn.innerHTML = 'Chercher';
    btn.disabled = false;
  }
}

function fillFormFromTMDB(data) {
  document.getElementById('formTitle').value = data.title;
  document.getElementById('formYear').value = data.year;
  document.getElementById('formRating').value = data.rating;
  document.getElementById('formPoster').value = data.poster;
  document.getElementById('formSynopsis').value = data.synopsis;
  document.getElementById('formTmdbId').value = data.id;
  if (data.type !== 'film') { document.getElementById('formType').value = data.type; updateFormType(); }
  showToast(`"${data.title}" import√© depuis TMDB`);
  document.getElementById('tmdbResults').innerHTML = '';
  document.getElementById('tmdbSearchInput').value = '';
  document.getElementById('formTitle').scrollIntoView({ behavior: 'smooth' });
}

function updateFormType() {
  const type = document.getElementById('formType').value;
  const epFields = document.getElementById('episodeFields');
  const filmLinksSection = document.getElementById('filmLinksSection');
  const seriesLinksSection = document.getElementById('seriesLinksSection');
  const addBtn = document.getElementById('addContentBtnText');
  if (type === 'series' || type === 'anime') {
    epFields.classList.remove('hidden'); epFields.style.display = 'grid';
    filmLinksSection.classList.add('hidden');
    seriesLinksSection.classList.remove('hidden');
    addBtn.textContent = 'Valider & Saisir les liens ‚Üí';
  } else {
    epFields.classList.add('hidden'); epFields.style.display = 'none';
    filmLinksSection.classList.remove('hidden');
    seriesLinksSection.classList.add('hidden');
    addBtn.textContent = 'Ajouter le contenu';
  }
}

function addLinkRow() {
  const row = document.createElement('div');
  row.className = 'link-row';
  row.style.cssText = 'display:flex;gap:0.5rem;margin-bottom:0.5rem;align-items:center;';
  row.innerHTML = `
    <input type="text" class="admin-input link-label" placeholder="Nom (ex: VF, VOSTFR...)" style="flex:0 0 180px;">
    <input type="text" class="admin-input link-url" placeholder="https://..." style="flex:1;">
    <button type="button" onclick="removeLinkRow(this)" style="background:rgba(255,0,110,0.15);border:1px solid var(--accent-pink);color:var(--accent-pink);width:32px;height:32px;border-radius:6px;cursor:pointer;flex-shrink:0;font-size:1rem;">‚úï</button>`;
  document.getElementById('linkRows').appendChild(row);
}

function removeLinkRow(btn) {
  const rows = document.querySelectorAll('#linkRows .link-row');
  if (rows.length <= 1) { showToast('Au moins un lien requis', 'error'); return; }
  btn.closest('.link-row').remove();
}

function resetForm() {
  ['formTitle','formYear','formRating','formGenre','formSeason','formEpisode','formSynopsis','formPoster','formTmdbId'].forEach(id => {
    const el = document.getElementById(id); if (el) el.value = '';
  });
  document.getElementById('formType').value = 'film';
  document.getElementById('formSeason').value = '1';
  document.getElementById('formEpisode').value = '1';
  document.getElementById('linkRows').innerHTML = `
    <div class="link-row" style="display:flex;gap:0.5rem;margin-bottom:0.5rem;align-items:center;">
      <input type="text" class="admin-input link-label" placeholder="Nom (ex: VF, VOSTFR...)" style="flex:0 0 180px;">
      <input type="text" class="admin-input link-url" placeholder="https://..." style="flex:1;">
      <button type="button" onclick="removeLinkRow(this)" style="background:rgba(255,0,110,0.15);border:1px solid var(--accent-pink);color:var(--accent-pink);width:32px;height:32px;border-radius:6px;cursor:pointer;flex-shrink:0;font-size:1rem;">‚úï</button>
    </div>`;
  updateFormType();
}

function addContent() {
  const title = document.getElementById('formTitle').value.trim();
  if (!title) return showToast('Titre requis', 'error');
  const type = document.getElementById('formType').value;
  if (type === 'film') {
    const linkRows = document.querySelectorAll('#linkRows .link-row');
    const links = [];
    for (const row of linkRows) {
      const url = row.querySelector('.link-url').value.trim();
      const label = row.querySelector('.link-label').value.trim();
      if (url) links.push({ label: label || extractDomain(url), url });
    }
    if (!links.length) return showToast('Au moins une URL requise', 'error');
    const item = buildBaseItem(title, type, links);
    const content = getContent(); content.push(item); saveContent(content);
    sendDiscordNotification(item);
    showToast(`"${title}" ajout√© avec succ√®s`);
    resetForm(); refreshAdminList(); renderRows(currentTab); updateHero();
  } else {
    const totalEpisodes = parseInt(document.getElementById('formEpisode').value) || 1;
    if (totalEpisodes < 1) return showToast('Nombre d\'√©pisodes invalide', 'error');
    const pendingItem = buildBaseItem(title, type, []);
    pendingItem.episodes = totalEpisodes;
    pendingItem.season = parseInt(document.getElementById('formSeason').value) || 1;
    pendingItem.episodeLinks = [];
    document.getElementById('adminPanelOverlay').classList.add('hidden');
    document.body.style.overflow = '';
    openEpisodeWizard(pendingItem);
  }
}

function buildBaseItem(title, type, links) {
  return {
    id: Date.now().toString(),
    title, type,
    year: document.getElementById('formYear').value || '',
    rating: parseFloat(document.getElementById('formRating').value) || null,
    genre: document.getElementById('formGenre').value.trim(),
    synopsis: document.getElementById('formSynopsis').value.trim(),
    poster: document.getElementById('formPoster').value.trim(),
    tmdbId: document.getElementById('formTmdbId').value.trim(),
    links, url: links[0]?.url || '', sourceType: 'embed',
  };
}

// ===== WIZARD =====
function openEpisodeWizard(pendingItem) {
  wizardData = {
    pendingItem, totalEpisodes: pendingItem.episodes, currentEp: 1,
    episodeLinks: Array.from({ length: pendingItem.episodes }, (_, i) => ({ ep: i + 1, links: [] }))
  };
  renderWizard();
  document.getElementById('episodeWizardOverlay').classList.remove('hidden');
  document.body.style.overflow = 'hidden';
}

function renderWizard() {
  const { pendingItem, totalEpisodes, currentEp, episodeLinks } = wizardData;
  const typeEmoji = pendingItem.type === 'anime' ? '‚õ©Ô∏è' : 'üì∫';
  document.getElementById('wizardStepBadge').textContent = `EP ${currentEp}/${totalEpisodes}`;
  document.getElementById('wizardProgressBar').style.width = (((currentEp - 1) / totalEpisodes) * 100) + '%';
  document.getElementById('wizardRecap').innerHTML = `${typeEmoji} <strong style="color:var(--text-primary);">${pendingItem.title}</strong> ‚Äî Saison ${pendingItem.season} ‚Äî <span style="color:var(--accent-cyan);">${totalEpisodes} √©pisodes</span> &nbsp;|&nbsp; √âpisode en cours : <strong style="color:var(--accent-cyan);">E${currentEp}</strong>`;
  const isLast = currentEp === totalEpisodes;
  document.getElementById('wizardNextBtnText').textContent = isLast ? '‚úÖ Terminer' : 'Suivant ‚ñ∂';
  const container = document.getElementById('wizardEpisodesContainer');
  container.innerHTML = '';
  episodeLinks.forEach((epData, idx) => {
    const epNum = idx + 1;
    const isCurrent = epNum === currentEp;
    const isPast = epNum < currentEp;
    const rowDiv = document.createElement('div');
    rowDiv.className = 'ep-link-row' + (isCurrent ? ' current' : '') + (isPast ? ' done' : '');
    rowDiv.id = `epRow_${epNum}`;
    const badge = document.createElement('div');
    badge.className = 'ep-number-badge';
    badge.textContent = `EP ${epNum}`;
    const inputWrap = document.createElement('div');
    inputWrap.className = 'ep-input-wrap';
    inputWrap.style.flex = '1';
    if (isCurrent) {
      inputWrap.innerHTML = buildEpisodeInputs(epNum, epData.links);
    } else if (isPast) {
      const hasLinks = epData.links.length > 0;
      inputWrap.innerHTML = hasLinks
        ? `<div style="font-size:0.82rem;color:var(--accent-green);padding:0.5rem 0;">${epData.links.map(l => `<span style="background:rgba(0,255,136,0.1);border:1px solid rgba(0,255,136,0.2);padding:2px 8px;border-radius:4px;margin-right:4px;">${l.label||extractDomain(l.url)}</span>`).join('')}</div>`
        : `<div style="font-size:0.8rem;color:var(--text-muted);padding:0.5rem 0;font-style:italic;">Pass√© (aucun lien)</div>`;
    } else {
      inputWrap.innerHTML = `<div style="font-size:0.8rem;color:var(--text-muted);padding:0.5rem 0;font-style:italic;opacity:0.5;">En attente...</div>`;
    }
    rowDiv.appendChild(badge); rowDiv.appendChild(inputWrap); container.appendChild(rowDiv);
    if (idx < episodeLinks.length - 1) {
      const sep = document.createElement('div');
      sep.style.cssText = 'height:1px;background:var(--border-color);margin:0.4rem 0;opacity:0.5;';
      container.appendChild(sep);
    }
  });
  setTimeout(() => { const el = document.getElementById(`epRow_${currentEp}`); if (el) el.scrollIntoView({ behavior: 'smooth', block: 'nearest' }); }, 50);
}

function buildEpisodeInputs(epNum, existingLinks) {
  const linksArr = existingLinks.length > 0 ? existingLinks : [{ label: '', url: '' }];
  let html = `<div class="ep-sources-container" id="epSources_${epNum}">`;
  linksArr.forEach((lk, i) => {
    html += `<div class="ep-source-row" data-src-idx="${i}">
      <input type="text" class="admin-input ep-src-label" placeholder="VF / VOSTFR / Source..." style="flex:0 0 160px;font-size:0.85rem;padding:0.6rem 0.75rem;" value="${lk.label||''}">
      <input type="text" class="admin-input ep-src-url" placeholder="https://..." style="flex:1;font-size:0.85rem;padding:0.6rem 0.75rem;" value="${lk.url||''}">
      ${i > 0 ? `<button onclick="removeEpSource(this,${epNum})" style="background:rgba(255,0,110,0.15);border:1px solid var(--accent-pink);color:var(--accent-pink);width:30px;height:30px;border-radius:6px;cursor:pointer;flex-shrink:0;font-size:0.9rem;">‚úï</button>` : '<div style="width:30px;flex-shrink:0;"></div>'}
    </div>`;
  });
  html += `</div><button onclick="addEpSource(${epNum})" style="margin-top:0.4rem;background:rgba(0,212,255,0.08);border:1px dashed rgba(0,212,255,0.3);color:var(--accent-cyan);padding:0.3rem 0.75rem;border-radius:6px;cursor:pointer;font-size:0.75rem;font-weight:700;letter-spacing:1px;">+ Ajouter une source</button>`;
  return html;
}

function addEpSource(epNum) {
  const container = document.getElementById(`epSources_${epNum}`);
  if (!container) return;
  const idx = container.querySelectorAll('.ep-source-row').length;
  const row = document.createElement('div');
  row.className = 'ep-source-row'; row.dataset.srcIdx = idx;
  row.innerHTML = `
    <input type="text" class="admin-input ep-src-label" placeholder="VF / VOSTFR / Source..." style="flex:0 0 160px;font-size:0.85rem;padding:0.6rem 0.75rem;">
    <input type="text" class="admin-input ep-src-url" placeholder="https://..." style="flex:1;font-size:0.85rem;padding:0.6rem 0.75rem;">
    <button onclick="removeEpSource(this,${epNum})" style="background:rgba(255,0,110,0.15);border:1px solid var(--accent-pink);color:var(--accent-pink);width:30px;height:30px;border-radius:6px;cursor:pointer;flex-shrink:0;font-size:0.9rem;">‚úï</button>`;
  container.appendChild(row);
}

function removeEpSource(btn, epNum) {
  const container = document.getElementById(`epSources_${epNum}`);
  if (!container) return;
  if (container.querySelectorAll('.ep-source-row').length <= 1) { showToast('Au moins une source', 'error'); return; }
  btn.closest('.ep-source-row').remove();
}

function collectCurrentEpLinks() {
  const container = document.getElementById(`epSources_${wizardData.currentEp}`);
  if (!container) return [];
  const links = [];
  container.querySelectorAll('.ep-source-row').forEach(row => {
    const url = row.querySelector('.ep-src-url').value.trim();
    const label = row.querySelector('.ep-src-label').value.trim();
    if (url) links.push({ label: label || extractDomain(url), url });
  });
  return links;
}

function wizardNext() {
  wizardData.episodeLinks[wizardData.currentEp - 1].links = collectCurrentEpLinks();
  if (wizardData.currentEp === wizardData.totalEpisodes) { finishWizard(); }
  else { wizardData.currentEp++; renderWizard(); }
}

function wizardSkipCurrent() {
  wizardData.episodeLinks[wizardData.currentEp - 1].links = [];
  if (wizardData.currentEp === wizardData.totalEpisodes) { finishWizard(); }
  else { wizardData.currentEp++; renderWizard(); }
}

function finishWizard() {
  const { pendingItem, episodeLinks, editMode, editId } = wizardData;

  if (editMode) {
    const content = getContent();
    const idx = content.findIndex(c => c.id === editId);
    if (idx !== -1) {
      content[idx].episodeLinks = episodeLinks;
      const flatLinks = [];
      episodeLinks.forEach(ep => { if (ep.links.length > 0) flatLinks.push(...ep.links); });
      content[idx].links = flatLinks; content[idx].url = flatLinks[0]?.url || '';
      saveContent(content);
    }
    document.getElementById('episodeWizardOverlay').classList.add('hidden');
    document.body.style.overflow = ''; wizardData = null;
    document.getElementById('adminPanelOverlay').classList.remove('hidden');
    document.body.style.overflow = 'hidden';
    showToast('Liens mis √† jour ‚úÖ'); refreshAdminList(); renderRows(currentTab);
    return;
  }

  pendingItem.episodeLinks = episodeLinks;
  const flatLinks = [];
  episodeLinks.forEach(ep => { if (ep.links.length > 0) flatLinks.push(...ep.links); });
  pendingItem.links = flatLinks; pendingItem.url = flatLinks[0]?.url || '';
  const content = getContent(); content.push(pendingItem); saveContent(content);
  sendDiscordNotification(pendingItem);
  document.getElementById('episodeWizardOverlay').classList.add('hidden');
  document.body.style.overflow = ''; wizardData = null;
  document.getElementById('adminPanelOverlay').classList.remove('hidden');
  document.body.style.overflow = 'hidden';
  showToast(`"${pendingItem.title}" ajout√© avec ${pendingItem.episodes} √©pisodes ‚úÖ`);
  resetForm(); refreshAdminList(); renderRows(currentTab); updateHero();
}

function cancelWizard() {
  if (!confirm('Annuler ? Le contenu ne sera pas sauvegard√©.')) return;
  document.getElementById('episodeWizardOverlay').classList.add('hidden');
  wizardData = null;
  document.getElementById('adminPanelOverlay').classList.remove('hidden');
  document.body.style.overflow = 'hidden';
}

function extractDomain(url) {
  try { return new URL(url).hostname.replace('www.', ''); } catch { return url.slice(0, 30); }
}

function saveWebhook() {
  const url = document.getElementById('webhookUrl').value.trim();
  if (!url) return showToast('URL webhook vide', 'error');
  localStorage.setItem('neya_webhook', url);
  showToast('Webhook sauvegard√© ‚úÖ');
  document.getElementById('webhookStatus').innerHTML = `<span style="color:var(--accent-green);">‚úÖ Webhook actif</span>`;
}

function testWebhook() {
  const url = document.getElementById('webhookUrl').value.trim() || localStorage.getItem('neya_webhook');
  if (!url) return showToast('Aucun webhook configur√©', 'error');
  const payload = { embeds: [{ title: 'üîî Test ‚Äî Neya fonctionne !', description: 'Le webhook Discord de **Neya** est correctement configur√©.', color: 0x00d4ff, footer: { text: 'Neya Streaming' } }] };
  fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) })
    .then(r => {
      if (r.ok) { showToast('Message test envoy√© ! üéâ'); document.getElementById('webhookStatus').innerHTML = `<span style="color:var(--accent-green);">‚úÖ Webhook valide et actif</span>`; }
      else { showToast('Erreur webhook', 'error'); document.getElementById('webhookStatus').innerHTML = `<span style="color:var(--accent-pink);">‚ùå Erreur : ${r.status}</span>`; }
    }).catch(() => showToast('Erreur r√©seau webhook', 'error'));
}

function sendDiscordNotification(item) {
  const webhookUrl = localStorage.getItem('neya_webhook');
  if (!webhookUrl) return;
  const typeEmoji = item.type==='film'?'üé¨':item.type==='series'?'üì∫':'‚õ©Ô∏è';
  const typeLabel = item.type==='film'?'Film':item.type==='series'?'S√©rie':'Anim√©';
  const color = item.type==='film'?0xff006e:item.type==='series'?0x00ff88:0x00d4ff;
  let description = `>>>     ${typeEmoji} **${item.title}**| Type : ${typeLabel}\n    üè∑Ô∏è **Cat√©gories** : ${item.genre||'Non renseign√©'}`;
  if ((item.type==='series'||item.type==='anime') && item.season) {
    description += `\n    üìÇ **Saison ${item.season}**`;
    if (item.episodes) description += ` ‚Äî ${item.episodes} √©pisode(s)`;
  }
  const embed = { title: `${typeEmoji} Nouveau Contenu Ajout√© !`, description, color };
  if (item.poster) embed.image = { url: item.poster };
  fetch(webhookUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ content: null, embeds: [embed], attachments: [] }) }).catch(() => {});
}

function refreshAdminList() {
  const content = getContent();
  document.getElementById('contentCountAdmin').textContent = content.length;
  const list = document.getElementById('adminContentList');
  if (!content.length) {
    list.innerHTML = `<div class="empty-state"><div class="empty-state-icon">üìã</div><div class="empty-state-text">Aucun contenu enregistr√©</div></div>`;
    return;
  }
  list.innerHTML = [...content].reverse().map(item => {
    let linksHtml = '';
    if (item.episodeLinks && item.episodeLinks.length > 0) {
      const withLinks = item.episodeLinks.filter(e => e.links.length > 0);
      linksHtml = `<div style="padding-left:52px;font-size:0.75rem;color:var(--text-muted);">
        <span style="color:var(--accent-cyan);">üì∫ ${withLinks.length}/${item.episodeLinks.length} √©pisodes avec liens</span>
        <button onclick="editEpisodeLinks('${item.id}')" style="margin-left:0.75rem;background:rgba(0,212,255,0.1);border:1px solid rgba(0,212,255,0.25);color:var(--accent-cyan);padding:2px 8px;border-radius:4px;cursor:pointer;font-size:0.7rem;">‚úèÔ∏è Modifier les liens</button>
      </div>`;
    } else {
      const links = item.links || (item.url ? [{ label: extractDomain(item.url), url: item.url }] : []);
      linksHtml = `<div style="padding-left:52px;">${links.map((lk, li) => `
        <div style="display:flex;align-items:center;gap:0.5rem;margin-top:0.3rem;padding:0.3rem 0.5rem;background:rgba(0,212,255,0.04);border:1px solid rgba(0,212,255,0.1);border-radius:6px;">
          <span style="color:var(--accent-cyan);font-size:0.7rem;font-weight:700;min-width:6px;">${li+1}</span>
          <span style="font-size:0.75rem;color:var(--accent-cyan);font-weight:600;min-width:80px;flex-shrink:0;">${lk.label||extractDomain(lk.url)}</span>
          <span style="font-size:0.7rem;color:var(--text-muted);flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${lk.url}</span>
          <button onclick="deleteLinkFromItem('${item.id}',${li})" style="background:rgba(255,0,110,0.15);border:1px solid var(--accent-pink);color:var(--accent-pink);padding:1px 6px;border-radius:4px;cursor:pointer;font-size:0.65rem;">‚úï</button>
        </div>`).join('')}</div>`;
    }
    return `
    <div class="content-list-item" style="flex-direction:column;align-items:stretch;gap:0.5rem;">
      <div style="display:flex;align-items:center;gap:1rem;">
        ${item.poster?`<img src="${item.poster}" alt="${item.title}" onerror="this.style.display='none'" style="width:40px;height:60px;object-fit:cover;border-radius:4px;flex-shrink:0;">` : '<div style="width:40px;height:60px;background:var(--bg-card);border-radius:4px;display:flex;align-items:center;justify-content:center;flex-shrink:0;">üé¨</div>'}
        <div class="content-list-info">
          <div class="content-list-title">${item.title}</div>
          <div class="content-list-meta">${item.type.toUpperCase()} ‚Ä¢ ${item.year||'?'} ‚Ä¢ ‚≠ê ${item.rating||'N/A'}${item.type!=='film'?` ‚Ä¢ S${item.season||1} - ${item.episodes||1} ep.`:''}</div>
        </div>
        <button class="admin-btn admin-btn-danger" style="font-size:0.7rem;padding:0.35rem 0.6rem;flex-shrink:0;" onclick="deleteContent('${item.id}')">üóë</button>
      </div>
      ${linksHtml}
    </div>`;
  }).join('');
}

function editEpisodeLinks(itemId) {
  const content = getContent();
  const item = content.find(c => c.id === itemId);
  if (!item || !item.episodeLinks) return;
  wizardData = {
    pendingItem: item, totalEpisodes: item.episodes, currentEp: 1,
    episodeLinks: item.episodeLinks.map(e => ({ ep: e.ep, links: [...(e.links||[])] })),
    editMode: true, editId: itemId
  };
  document.getElementById('adminPanelOverlay').classList.add('hidden');
  renderWizard();
  document.getElementById('episodeWizardOverlay').classList.remove('hidden');
  document.body.style.overflow = 'hidden';
}

function deleteLinkFromItem(itemId, linkIndex) {
  const content = getContent();
  const item = content.find(c => c.id === itemId);
  if (!item) return;
  const links = item.links || (item.url ? [{ label: extractDomain(item.url), url: item.url }] : []);
  if (links.length <= 1) { showToast('Impossible de supprimer le dernier lien', 'error'); return; }
  links.splice(linkIndex, 1);
  item.links = links; item.url = links[0].url;
  saveContent(content); refreshAdminList(); showToast('Lien supprim√©');
}

function deleteContent(id) {
  if (!confirm('Supprimer ce contenu ?')) return;
  saveContent(getContent().filter(c => c.id !== id));
  refreshAdminList(); renderRows(currentTab); updateHero(); showToast('Contenu supprim√©');
}

function clearAllContent() {
  if (!confirm('Supprimer TOUT le contenu ? Cette action est irr√©versible.')) return;
  saveContent([]); refreshAdminList(); renderRows(currentTab); updateHero();
  showToast('Tout le contenu a √©t√© supprim√©');
}

function previewDomain() {
  const oldD = document.getElementById('domainOld').value.trim().replace(/^https?:\/\//, '');
  const newD = document.getElementById('domainNew').value.trim().replace(/^https?:\/\//, '');
  const preview = document.getElementById('domainPreview');
  if (!oldD || !newD) { preview.textContent = ''; return; }
  const content = getContent();
  let count = 0;
  content.forEach(c => {
    (c.links||[]).forEach(lk => { if (lk.url && lk.url.includes(oldD)) count++; });
    if (!c.links && c.url && c.url.includes(oldD)) count++;
    (c.episodeLinks||[]).forEach(ep => (ep.links||[]).forEach(lk => { if (lk.url && lk.url.includes(oldD)) count++; }));
  });
  preview.innerHTML = count === 0
    ? `<span style="color:var(--accent-pink);">‚ö†Ô∏è Aucun lien contenant <strong>${oldD}</strong> trouv√©.</span>`
    : `<span style="color:var(--accent-green);">‚úÖ ${count} lien(s) seront modifi√©s : <strong>${oldD}</strong> ‚Üí <strong>${newD}</strong></span>`;
}

function replaceDomain() {
  const oldD = document.getElementById('domainOld').value.trim().replace(/^https?:\/\//, '');
  const newD = document.getElementById('domainNew').value.trim().replace(/^https?:\/\//, '');
  if (!oldD) return showToast('Entrez l\'ancien domaine', 'error');
  if (!newD) return showToast('Entrez le nouveau domaine', 'error');
  if (oldD === newD) return showToast('Les domaines sont identiques', 'error');
  const content = getContent();
  let count = 0;
  const updated = content.map(item => {
    if (item.links) {
      item.links = item.links.map(lk => {
        if (lk.url && lk.url.includes(oldD)) { lk.url = lk.url.replaceAll(oldD, newD); if (lk.label===oldD) lk.label=newD; count++; }
        return lk;
      });
      if (item.links.length > 0) item.url = item.links[0].url;
    } else if (item.url && item.url.includes(oldD)) { item.url = item.url.replaceAll(oldD, newD); count++; }
    if (item.episodeLinks) {
      item.episodeLinks.forEach(ep => {
        ep.links = (ep.links||[]).map(lk => {
          if (lk.url && lk.url.includes(oldD)) { lk.url = lk.url.replaceAll(oldD, newD); count++; }
          return lk;
        });
      });
    }
    return item;
  });
  if (count === 0) return showToast(`Aucun lien avec "${oldD}" trouv√©`, 'error');
  saveContent(updated);
  document.getElementById('domainOld').value = '';
  document.getElementById('domainNew').value = '';
  document.getElementById('domainPreview').textContent = '';
  refreshAdminList(); renderRows(currentTab);
  showToast(`‚úÖ ${count} lien(s) mis √† jour !`);
}

document.addEventListener('DOMContentLoaded', () => {
  createParticles();
  renderRows('all');
  updateHero();
  updateFormType();
  document.getElementById('videoModal').addEventListener('click', function(e) { if (e.target===this) closeModal('videoModal'); });
  document.getElementById('adminLoginOverlay').addEventListener('click', function(e) { if (e.target===this) closeModal('adminLoginOverlay'); });
  document.getElementById('adminPanelOverlay').addEventListener('click', function(e) { if (e.target===this) { closeModal('adminPanelOverlay'); document.body.style.overflow=''; } });
});
</script>
</body>
</html>
